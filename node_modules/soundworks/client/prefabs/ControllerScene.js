'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _assign = require('babel-runtime/core-js/object/assign');

var _assign2 = _interopRequireDefault(_assign);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _basicControllers = require('basic-controllers');

var controllers = _interopRequireWildcard(_basicControllers);

var _View = require('../views/View');

var _View2 = _interopRequireDefault(_View);

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

controllers.setTheme('dark');

/* --------------------------------------------------------- */
/* GUIs
/* --------------------------------------------------------- */

/** @private */

var _BooleanGui = function () {
  function _BooleanGui($container, param, guiOptions) {
    (0, _classCallCheck3.default)(this, _BooleanGui);
    var label = param.label,
        value = param.value;


    this.controller = new controllers.Toggle({
      label: label,
      default: value,
      container: $container,
      callback: function callback(value) {
        if (guiOptions.confirm) {
          var msg = 'Are you sure you want to propagate "' + param.name + ':' + value + '"';
          if (!window.confirm(msg)) {
            return;
          }
        }

        param.update(value);
      }
    });
  }

  (0, _createClass3.default)(_BooleanGui, [{
    key: 'set',
    value: function set(val) {
      this.controller.value = val;
    }
  }]);
  return _BooleanGui;
}();

/** @private */


var _EnumGui = function () {
  function _EnumGui($container, param, guiOptions) {
    (0, _classCallCheck3.default)(this, _EnumGui);
    var label = param.label,
        options = param.options,
        value = param.value;


    var ctor = guiOptions.type === 'buttons' ? controllers.SelectButtons : controllers.SelectList;

    this.controller = new ctor({
      label: label,
      options: options,
      default: value,
      container: $container,
      callback: function callback(value) {
        if (guiOptions.confirm) {
          var msg = 'Are you sure you want to propagate "' + param.name + ':' + value + '"';
          if (!window.confirm(msg)) {
            return;
          }
        }

        param.update(value);
      }
    });
  }

  (0, _createClass3.default)(_EnumGui, [{
    key: 'set',
    value: function set(val) {
      this.controller.value = val;
    }
  }]);
  return _EnumGui;
}();

/** @private */


var _NumberGui = function () {
  function _NumberGui($container, param, guiOptions) {
    (0, _classCallCheck3.default)(this, _NumberGui);
    var label = param.label,
        min = param.min,
        max = param.max,
        step = param.step,
        value = param.value;


    if (guiOptions.type === 'slider') {
      this.controller = new controllers.Slider({
        label: label,
        min: min,
        max: max,
        step: step,
        default: value,
        unit: guiOptions.param ? guiOptions.param : '',
        size: guiOptions.size,
        container: $container
      });
    } else {
      this.controller = new controllers.NumberBox({
        label: label,
        min: min,
        max: max,
        step: step,
        default: value,
        container: $container
      });
    }

    this.controller.addListener(function (value) {
      if (guiOptions.confirm) {
        var msg = 'Are you sure you want to propagate "' + param.name + ':' + value + '"';
        if (!window.confirm(msg)) {
          return;
        }
      }

      param.update(value);
    });
  }

  (0, _createClass3.default)(_NumberGui, [{
    key: 'set',
    value: function set(val) {
      this.controller.value = val;
    }
  }]);
  return _NumberGui;
}();

/** @private */


var _TextGui = function () {
  function _TextGui($container, param, guiOptions) {
    (0, _classCallCheck3.default)(this, _TextGui);
    var label = param.label,
        value = param.value;


    this.controller = new controllers.Text({
      label: label,
      default: value,
      readonly: guiOptions.readonly,
      container: $container
    });

    if (!guiOptions.readonly) {
      this.controller.addListener(function (value) {
        if (guiOptions.confirm) {
          var msg = 'Are you sure you want to propagate "' + param.name + '"';
          if (!window.confirm(msg)) {
            return;
          }
        }

        param.update(value);
      });
    }
  }

  (0, _createClass3.default)(_TextGui, [{
    key: 'set',
    value: function set(val) {
      this.controller.value = val;
    }
  }]);
  return _TextGui;
}();

/** @private */


var _TriggerGui = function () {
  function _TriggerGui($container, param, guiOptions) {
    (0, _classCallCheck3.default)(this, _TriggerGui);
    var label = param.label;


    this.controller = new controllers.TriggerButtons({
      options: [label],
      container: $container,
      callback: function callback() {
        if (guiOptions.confirm) {
          var msg = 'Are you sure you want to propagate "' + param.name + '"';
          if (!window.confirm(msg)) {
            return;
          }
        }

        param.update();
      }
    });
  }

  (0, _createClass3.default)(_TriggerGui, [{
    key: 'set',
    value: function set(val) {/* nothing to set here */}
  }]);
  return _TriggerGui;
}();

var SCENE_ID = 'basic-shared-controller';

/**
 * The `ControllerScene` scene propose a simple / default way to create
 * a controller view for the `shared-params` service.
 *
 * Each controller comes with a set of options that can be passed to the
 * constructor.
 *
 * @memberof module:soundworks/client
 * @see [`shared-params` service]{@link module:soundworks/client.SharedParams}
 */

var ControllerScene = function () {
  /**
   * _<span class="warning">__WARNING__</span> This API is unstable, and
   * subject to change in further versions.
   */
  function ControllerScene(experience, sharedParams) {
    (0, _classCallCheck3.default)(this, ControllerScene);

    if (!sharedParams) throw new Error('This service requires the "shared params" service');

    this._guiOptions = {};

    this.experience = experience;
    this.sharedParams = sharedParams;
  }

  (0, _createClass3.default)(ControllerScene, [{
    key: 'enter',
    value: function enter() {
      var _this = this;

      this.view = new _View2.default();
      this.view.options.id = 'basic-shared-controller';

      this.view.render();
      this.view.appendTo(this.experience.container);

      var _loop = function _loop(name) {
        var param = _this.sharedParams.params[name];
        var gui = _this._createGui(param);

        param.addListener('update', function (val) {
          return gui.set(val);
        });
      };

      for (var name in this.sharedParams.params) {
        _loop(name);
      }
    }
  }, {
    key: 'exit',
    value: function exit() {
      for (var name in this.sharedParams.params) {
        var param = this.sharedParams.params[name];
        param.removeListener('update');
      }

      this.view.remove();
    }

    /**
     * Configure the GUI for a given parameter, this method only makes sens if
     * `options.hasGUI=true`.
     * @param {String} name - Name of the parameter to configure.
     * @param {Object} options - Options to configure the parameter GUI.
     * @param {String} options.type - Type of GUI to use. Each type of parameter can
     *  used with different GUI according to their type and comes with acceptable
     *  default values.
     * @param {Boolean} [options.show=true] - Display or not the GUI for this parameter.
     * @param {Boolean} [options.confirm=false] - Ask for confirmation when the value changes.
     */

  }, {
    key: 'setGuiOptions',
    value: function setGuiOptions(name, options) {
      this._guiOptions[name] = options;
    }

    /** @private */

  }, {
    key: '_createGui',
    value: function _createGui(param) {
      var config = (0, _assign2.default)({
        show: true,
        confirm: false
      }, this._guiOptions[param.name]);

      if (config.show === false) return null;

      var gui = null;
      var $container = this.view.$el;

      switch (param.type) {
        case 'boolean':
          gui = new _BooleanGui($container, param, config); // `Toggle`
          break;
        case 'enum':
          gui = new _EnumGui($container, param, config); // `SelectList` or `SelectButtons`
          break;
        case 'number':
          gui = new _NumberGui($container, param, config); // `NumberBox` or `Slider`
          break;
        case 'text':
          gui = new _TextGui($container, param, config); // `Text`
          break;
        case 'trigger':
          gui = new _TriggerGui($container, param, config);
          break;
      }

      return gui;
    }
  }]);
  return ControllerScene;
}();

exports.default = ControllerScene;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkNvbnRyb2xsZXJTY2VuZS5qcyJdLCJuYW1lcyI6WyJjb250cm9sbGVycyIsInNldFRoZW1lIiwiX0Jvb2xlYW5HdWkiLCIkY29udGFpbmVyIiwicGFyYW0iLCJndWlPcHRpb25zIiwibGFiZWwiLCJ2YWx1ZSIsImNvbnRyb2xsZXIiLCJUb2dnbGUiLCJkZWZhdWx0IiwiY29udGFpbmVyIiwiY2FsbGJhY2siLCJjb25maXJtIiwibXNnIiwibmFtZSIsIndpbmRvdyIsInVwZGF0ZSIsInZhbCIsIl9FbnVtR3VpIiwib3B0aW9ucyIsImN0b3IiLCJ0eXBlIiwiU2VsZWN0QnV0dG9ucyIsIlNlbGVjdExpc3QiLCJfTnVtYmVyR3VpIiwibWluIiwibWF4Iiwic3RlcCIsIlNsaWRlciIsInVuaXQiLCJzaXplIiwiTnVtYmVyQm94IiwiYWRkTGlzdGVuZXIiLCJfVGV4dEd1aSIsIlRleHQiLCJyZWFkb25seSIsIl9UcmlnZ2VyR3VpIiwiVHJpZ2dlckJ1dHRvbnMiLCJTQ0VORV9JRCIsIkNvbnRyb2xsZXJTY2VuZSIsImV4cGVyaWVuY2UiLCJzaGFyZWRQYXJhbXMiLCJFcnJvciIsIl9ndWlPcHRpb25zIiwidmlldyIsIlZpZXciLCJpZCIsInJlbmRlciIsImFwcGVuZFRvIiwicGFyYW1zIiwiZ3VpIiwiX2NyZWF0ZUd1aSIsInNldCIsInJlbW92ZUxpc3RlbmVyIiwicmVtb3ZlIiwiY29uZmlnIiwic2hvdyIsIiRlbCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7O0lBQVlBLFc7O0FBQ1o7Ozs7Ozs7O0FBRUFBLFlBQVlDLFFBQVosQ0FBcUIsTUFBckI7O0FBRUE7QUFDQTs7O0FBR0E7O0lBQ01DLFc7QUFDSix1QkFBWUMsVUFBWixFQUF3QkMsS0FBeEIsRUFBK0JDLFVBQS9CLEVBQTJDO0FBQUE7QUFBQSxRQUNqQ0MsS0FEaUMsR0FDaEJGLEtBRGdCLENBQ2pDRSxLQURpQztBQUFBLFFBQzFCQyxLQUQwQixHQUNoQkgsS0FEZ0IsQ0FDMUJH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SXlDLE9BQU9DLElBQVAsS0FBZ0IsS0FBcEIsRUFBMkIsT0FBTyxJQUFQOztBQUUzQixVQUFJTixNQUFNLElBQVY7QUFDQSxVQUFNaEQsYUFBYSxLQUFLMEMsSUFBTCxDQUFVYSxHQUE3Qjs7QUFFQSxjQUFRdEQsTUFBTWtCLElBQWQ7QUFDRSxhQUFLLFNBQUw7QUFDRTZCLGdCQUFNLElBQUlqRCxXQUFKLENBQWdCQyxVQUFoQixFQUE0QkMsS0FBNUIsRUFBbUNvRCxNQUFuQyxDQUFOLENBREYsQ0FDb0Q7QUFDbEQ7QUFDRixhQUFLLE1BQUw7QUFDRUwsZ0JBQU0sSUFBSWhDLFFBQUosQ0FBYWhCLFVBQWIsRUFBeUJDLEtBQXpCLEVBQWdDb0QsTUFBaEMsQ0FBTixDQURGLENBQ2lEO0FBQy9DO0FBQ0YsYUFBSyxRQUFMO0FBQ0VMLGdCQUFNLElBQUkxQixVQUFKLENBQWV0QixVQUFmLEVBQTJCQyxLQUEzQixFQUFrQ29ELE1BQWxDLENBQU4sQ0FERixDQUNtRDtBQUNqRDtBQUNGLGFBQUssTUFBTDtBQUNFTCxnQkFBTSxJQUFJakIsUUFBSixDQUFhL0IsVUFBYixFQUF5QkMsS0FBekIsRUFBZ0NvRCxNQUFoQyxDQUFOLENBREYsQ0FDaUQ7QUFDL0M7QUFDRixhQUFLLFNBQUw7QUFDRUwsZ0JBQU0sSUFBSWQsV0FBSixDQUFnQmxDLFVBQWhCLEVBQTRCQyxLQUE1QixFQUFtQ29ELE1BQW5DLENBQU47QUFDQTtBQWZKOztBQWtCQSxhQUFPTCxHQUFQO0FBQ0Q7Ozs7O2tCQUdZWCxlIiwiZmlsZSI6IkNvbnRyb2xsZXJTY2VuZS5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGNvbnRyb2xsZXJzIGZyb20gJ2Jhc2ljLWNvbnRyb2xsZXJzJztcbmltcG9ydCBWaWV3IGZyb20gJy4uL3ZpZXdzL1ZpZXcnO1xuXG5jb250cm9sbGVycy5zZXRUaGVtZSgnZGFyaycpO1xuXG4vKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi9cbi8qIEdVSXNcbi8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG4vKiogQHByaXZhdGUgKi9cbmNsYXNzIF9Cb29sZWFuR3VpIHtcbiAgY29uc3RydWN0b3IoJGNvbnRhaW5lciwgcGFyYW0sIGd1aU9wdGlvbnMpIHtcbiAgICBjb25zdCB7IGxhYmVsLCB2YWx1ZSB9ID0gcGFyYW07XG5cbiAgICB0aGlzLmNvbnRyb2xsZXIgPSBuZXcgY29udHJvbGxlcnMuVG9nZ2xlKHtcbiAgICAgIGxhYmVsOiBsYWJlbCxcbiAgICAgIGRlZmF1bHQ6IHZhbHVlLFxuICAgICAgY29udGFpbmVyOiAkY29udGFpbmVyLFxuICAgICAgY2FsbGJhY2s6ICh2YWx1ZSkgPT4ge1xuICAgICAgICBpZiAoZ3VpT3B0aW9ucy5jb25maXJtKSB7XG4gICAgICAgICAgY29uc3QgbXNnID0gYEFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBwcm9wYWdhdGUgXCIke3BhcmFtLm5hbWV9OiR7dmFsdWV9XCJgO1xuICAgICAgICAgIGlmICghd2luZG93LmNvbmZpcm0obXNnKSkgeyByZXR1cm47IH1cbiAgICAgICAgfVxuXG4gICAgICAgIHBhcmFtLnVwZGF0ZSh2YWx1ZSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBzZXQodmFsKSB7XG4gICAgdGhpcy5jb250cm9sbGVyLnZhbHVlID0gdmFsO1xuICB9XG59XG5cbi8qKiBAcHJpdmF0ZSAqL1xuY2xhc3MgX0VudW1HdWkge1xuICBjb25zdHJ1Y3RvcigkY29udGFpbmVyLCBwYXJhbSwgZ3VpT3B0aW9ucykge1xuICAgIGNvbnN0IHsgbGFiZWwsIG9wdGlvbnMsIHZhbHVlIH0gPSBwYXJhbTtcblxuICAgIGNvbnN0IGN0b3IgPSBndWlPcHRpb25zLnR5cGUgPT09ICdidXR0b25zJyA/XG4gICAgICBjb250cm9sbGVycy5TZWxlY3RCdXR0b25zIDogY29udHJvbGxlcnMuU2VsZWN0TGlzdFxuXG4gICAgdGhpcy5jb250cm9sbGVyID0gbmV3IGN0b3Ioe1xuICAgICAgbGFiZWw6IGxhYmVsLFxuICAgICAgb3B0aW9uczogb3B0aW9ucyxcbiAgICAgIGRlZmF1bHQ6IHZhbHVlLFxuICAgICAgY29udGFpbmVyOiAkY29udGFpbmVyLFxuICAgICAgY2FsbGJhY2s6ICh2YWx1ZSkgPT4ge1xuICAgICAgICBpZiAoZ3VpT3B0aW9ucy5jb25maXJtKSB7XG4gICAgICAgICAgY29uc3QgbXNnID0gYEFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBwcm9wYWdhdGUgXCIke3BhcmFtLm5hbWV9OiR7dmFsdWV9XCJgO1xuICAgICAgICAgIGlmICghd2luZG93LmNvbmZpcm0obXNnKSkgeyByZXR1cm47IH1cbiAgICAgICAgfVxuXG4gICAgICAgIHBhcmFtLnVwZGF0ZSh2YWx1ZSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBzZXQodmFsKSB7XG4gICAgdGhpcy5jb250cm9sbGVyLnZhbHVlID0gdmFsO1xuICB9XG59XG5cbi8qKiBAcHJpdmF0ZSAqL1xuY2xhc3MgX051bWJlckd1aSB7XG4gIGNvbnN0cnVjdG9yKCRjb250YWluZXIsIHBhcmFtLCBndWlPcHRpb25zKSB7XG4gICAgY29uc3QgeyBsYWJlbCwgbWluLCBtYXgsIHN0ZXAsIHZhbHVlIH0gPSBwYXJhbTtcblxuICAgIGlmIChndWlPcHRpb25zLnR5cGUgPT09ICdzbGlkZXInKSB7XG4gICAgICB0aGlzLmNvbnRyb2xsZXIgPSBuZXcgY29udHJvbGxlcnMuU2xpZGVyKHtcbiAgICAgICAgbGFiZWw6IGxhYmVsLFxuICAgICAgICBtaW46IG1pbixcbiAgICAgICAgbWF4OiBtYXgsXG4gICAgICAgIHN0ZXA6IHN0ZXAsXG4gICAgICAgIGRlZmF1bHQ6IHZhbHVlLFxuICAgICAgICB1bml0OiBndWlPcHRpb25zLnBhcmFtID8gZ3VpT3B0aW9ucy5wYXJhbSA6ICcnLFxuICAgICAgICBzaXplOiBndWlPcHRpb25zLnNpemUsXG4gICAgICAgIGNvbnRhaW5lcjogJGNvbnRhaW5lcixcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmNvbnRyb2xsZXIgPSBuZXcgY29udHJvbGxlcnMuTnVtYmVyQm94KHtcbiAgICAgICAgbGFiZWw6IGxhYmVsLFxuICAgICAgICBtaW46IG1pbixcbiAgICAgICAgbWF4OiBtYXgsXG4gICAgICAgIHN0ZXA6IHN0ZXAsXG4gICAgICAgIGRlZmF1bHQ6IHZhbHVlLFxuICAgICAgICBjb250YWluZXI6ICRjb250YWluZXIsXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICB0aGlzLmNvbnRyb2xsZXIuYWRkTGlzdGVuZXIoKHZhbHVlKSA9PiB7XG4gICAgICBpZiAoZ3VpT3B0aW9ucy5jb25maXJtKSB7XG4gICAgICAgIGNvbnN0IG1zZyA9IGBBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gcHJvcGFnYXRlIFwiJHtwYXJhbS5uYW1lfToke3ZhbHVlfVwiYDtcbiAgICAgICAgaWYgKCF3aW5kb3cuY29uZmlybShtc2cpKSB7IHJldHVybjsgfVxuICAgICAgfVxuXG4gICAgICBwYXJhbS51cGRhdGUodmFsdWUpO1xuICAgIH0pO1xuICB9XG5cbiAgc2V0KHZhbCkge1xuICAgIHRoaXMuY29udHJvbGxlci52YWx1ZSA9IHZhbDtcbiAgfVxufVxuXG4vKiogQHByaXZhdGUgKi9cbmNsYXNzIF9UZXh0R3VpIHtcbiAgY29uc3RydWN0b3IoJGNvbnRhaW5lciwgcGFyYW0sIGd1aU9wdGlvbnMpIHtcbiAgICBjb25zdCB7IGxhYmVsLCB2YWx1ZSB9ID0gcGFyYW07XG5cbiAgICB0aGlzLmNvbnRyb2xsZXIgPSBuZXcgY29udHJvbGxlcnMuVGV4dCh7XG4gICAgICBsYWJlbDogbGFiZWwsXG4gICAgICBkZWZhdWx0OiB2YWx1ZSxcbiAgICAgIHJlYWRvbmx5OiBndWlPcHRpb25zLnJlYWRvbmx5LFxuICAgICAgY29udGFpbmVyOiAkY29udGFpbmVyLFxuICAgIH0pO1xuXG4gICAgaWYgKCFndWlPcHRpb25zLnJlYWRvbmx5KSB7XG4gICAgICB0aGlzLmNvbnRyb2xsZXIuYWRkTGlzdGVuZXIoKHZhbHVlKSA9PiB7XG4gICAgICAgIGlmIChndWlPcHRpb25zLmNvbmZpcm0pIHtcbiAgICAgICAgICBjb25zdCBtc2cgPSBgQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIHByb3BhZ2F0ZSBcIiR7cGFyYW0ubmFtZX1cImA7XG4gICAgICAgICAgaWYgKCF3aW5kb3cuY29uZmlybShtc2cpKSB7IHJldHVybjsgfVxuICAgICAgICB9XG5cbiAgICAgICAgcGFyYW0udXBkYXRlKHZhbHVlKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHNldCh2YWwpIHtcbiAgICB0aGlzLmNvbnRyb2xsZXIudmFsdWUgPSB2YWw7XG4gIH1cbn1cblxuLyoqIEBwcml2YXRlICovXG5jbGFzcyBfVHJpZ2dlckd1aSB7XG4gIGNvbnN0cnVjdG9yKCRjb250YWluZXIsIHBhcmFtLCBndWlPcHRpb25zKSB7XG4gICAgY29uc3QgeyBsYWJlbCB9ID0gcGFyYW07XG5cbiAgICB0aGlzLmNvbnRyb2xsZXIgPSBuZXcgY29udHJvbGxlcnMuVHJpZ2dlckJ1dHRvbnMoe1xuICAgICAgb3B0aW9uczogW2xhYmVsXSxcbiAgICAgIGNvbnRhaW5lcjogJGNvbnRhaW5lcixcbiAgICAgIGNhbGxiYWNrOiAoKSA9PiB7XG4gICAgICAgIGlmIChndWlPcHRpb25zLmNvbmZpcm0pIHtcbiAgICAgICAgICBjb25zdCBtc2cgPSBgQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIHByb3BhZ2F0ZSBcIiR7cGFyYW0ubmFtZX1cImA7XG4gICAgICAgICAgaWYgKCF3aW5kb3cuY29uZmlybShtc2cpKSB7IHJldHVybjsgfVxuICAgICAgICB9XG5cbiAgICAgICAgcGFyYW0udXBkYXRlKCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBzZXQodmFsKSB7IC8qIG5vdGhpbmcgdG8gc2V0IGhlcmUgKi8gfVxufVxuXG5jb25zdCBTQ0VORV9JRCA9ICdiYXNpYy1zaGFyZWQtY29udHJvbGxlcic7XG5cbi8qKlxuICogVGhlIGBDb250cm9sbGVyU2NlbmVgIHNjZW5lIHByb3Bvc2UgYSBzaW1wbGUgLyBkZWZhdWx0IHdheSB0byBjcmVhdGVcbiAqIGEgY29udHJvbGxlciB2aWV3IGZvciB0aGUgYHNoYXJlZC1wYXJhbXNgIHNlcnZpY2UuXG4gKlxuICogRWFjaCBjb250cm9sbGVyIGNvbWVzIHdpdGggYSBzZXQgb2Ygb3B0aW9ucyB0aGF0IGNhbiBiZSBwYXNzZWQgdG8gdGhlXG4gKiBjb25zdHJ1Y3Rvci5cbiAqXG4gKiBAbWVtYmVyb2YgbW9kdWxlOnNvdW5kd29ya3MvY2xpZW50XG4gKiBAc2VlIFtgc2hhcmVkLXBhcmFtc2Agc2VydmljZV17QGxpbmsgbW9kdWxlOnNvdW5kd29ya3MvY2xpZW50LlNoYXJlZFBhcmFtc31cbiAqL1xuY2xhc3MgQ29udHJvbGxlclNjZW5lIHtcbiAgLyoqXG4gICAqIF88c3BhbiBjbGFzcz1cIndhcm5pbmdcIj5fX1dBUk5JTkdfXzwvc3Bhbj4gVGhpcyBBUEkgaXMgdW5zdGFibGUsIGFuZFxuICAgKiBzdWJqZWN0IHRvIGNoYW5nZSBpbiBmdXJ0aGVyIHZlcnNpb25zLlxuICAgKi9cbiAgY29uc3RydWN0b3IoZXhwZXJpZW5jZSwgc2hhcmVkUGFyYW1zKSB7XG4gICAgaWYgKCFzaGFyZWRQYXJhbXMpXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoaXMgc2VydmljZSByZXF1aXJlcyB0aGUgXCJzaGFyZWQgcGFyYW1zXCIgc2VydmljZScpO1xuXG4gICAgdGhpcy5fZ3VpT3B0aW9ucyA9IHt9O1xuXG4gICAgdGhpcy5leHBlcmllbmNlID0gZXhwZXJpZW5jZTtcbiAgICB0aGlzLnNoYXJlZFBhcmFtcyA9IHNoYXJlZFBhcmFtcztcbiAgfVxuXG4gIGVudGVyKCkge1xuICAgIHRoaXMudmlldyA9IG5ldyBWaWV3KCk7XG4gICAgdGhpcy52aWV3Lm9wdGlvbnMuaWQgPSAnYmFzaWMtc2hhcmVkLWNvbnRyb2xsZXInO1xuXG4gICAgdGhpcy52aWV3LnJlbmRlcigpO1xuICAgIHRoaXMudmlldy5hcHBlbmRUbyh0aGlzLmV4cGVyaWVuY2UuY29udGFpbmVyKTtcblxuICAgIGZvciAobGV0IG5hbWUgaW4gdGhpcy5zaGFyZWRQYXJhbXMucGFyYW1zKSB7XG4gICAgICBjb25zdCBwYXJhbSA9IHRoaXMuc2hhcmVkUGFyYW1zLnBhcmFtc1tuYW1lXTtcbiAgICAgIGNvbnN0IGd1aSA9IHRoaXMuX2NyZWF0ZUd1aShwYXJhbSk7XG5cbiAgICAgIHBhcmFtLmFkZExpc3RlbmVyKCd1cGRhdGUnLCAodmFsKSA9PiBndWkuc2V0KHZhbCkpO1xuICAgIH1cbiAgfVxuXG4gIGV4aXQoKSB7XG4gICAgZm9yIChsZXQgbmFtZSBpbiB0aGlzLnNoYXJlZFBhcmFtcy5wYXJhbXMpIHtcbiAgICAgIGNvbnN0IHBhcmFtID0gdGhpcy5zaGFyZWRQYXJhbXMucGFyYW1zW25hbWVdO1xuICAgICAgcGFyYW0ucmVtb3ZlTGlzdGVuZXIoJ3VwZGF0ZScpO1xuICAgIH1cblxuICAgIHRoaXMudmlldy5yZW1vdmUoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb25maWd1cmUgdGhlIEdVSSBmb3IgYSBnaXZlbiBwYXJhbWV0ZXIsIHRoaXMgbWV0aG9kIG9ubHkgbWFrZXMgc2VucyBpZlxuICAgKiBgb3B0aW9ucy5oYXNHVUk9dHJ1ZWAuXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lIC0gTmFtZSBvZiB0aGUgcGFyYW1ldGVyIHRvIGNvbmZpZ3VyZS5cbiAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgLSBPcHRpb25zIHRvIGNvbmZpZ3VyZSB0aGUgcGFyYW1ldGVyIEdVSS5cbiAgICogQHBhcmFtIHtTdHJpbmd9IG9wdGlvbnMudHlwZSAtIFR5cGUgb2YgR1VJIHRvIHVzZS4gRWFjaCB0eXBlIG9mIHBhcmFtZXRlciBjYW5cbiAgICogIHVzZWQgd2l0aCBkaWZmZXJlbnQgR1VJIGFjY29yZGluZyB0byB0aGVpciB0eXBlIGFuZCBjb21lcyB3aXRoIGFjY2VwdGFibGVcbiAgICogIGRlZmF1bHQgdmFsdWVzLlxuICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtvcHRpb25zLnNob3c9dHJ1ZV0gLSBEaXNwbGF5IG9yIG5vdCB0aGUgR1VJIGZvciB0aGlzIHBhcmFtZXRlci5cbiAgICogQHBhcmFtIHtCb29sZWFufSBbb3B0aW9ucy5jb25maXJtPWZhbHNlXSAtIEFzayBmb3IgY29uZmlybWF0aW9uIHdoZW4gdGhlIHZhbHVlIGNoYW5nZXMuXG4gICAqL1xuICBzZXRHdWlPcHRpb25zKG5hbWUsIG9wdGlvbnMpIHtcbiAgICB0aGlzLl9ndWlPcHRpb25zW25hbWVdID0gb3B0aW9ucztcbiAgfVxuXG4gIC8qKiBAcHJpdmF0ZSAqL1xuICBfY3JlYXRlR3VpKHBhcmFtKSB7XG4gICAgY29uc3QgY29uZmlnID0gT2JqZWN0LmFzc2lnbih7XG4gICAgICBzaG93OiB0cnVlLFxuICAgICAgY29uZmlybTogZmFsc2UsXG4gICAgfSwgdGhpcy5fZ3VpT3B0aW9uc1twYXJhbS5uYW1lXSk7XG5cbiAgICBpZiAoY29uZmlnLnNob3cgPT09IGZhbHNlKSByZXR1cm4gbnVsbDtcblxuICAgIGxldCBndWkgPSBudWxsO1xuICAgIGNvbnN0ICRjb250YWluZXIgPSB0aGlzLnZpZXcuJGVsO1xuXG4gICAgc3dpdGNoIChwYXJhbS50eXBlKSB7XG4gICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgZ3VpID0gbmV3IF9Cb29sZWFuR3VpKCRjb250YWluZXIsIHBhcmFtLCBjb25maWcpOyAvLyBgVG9nZ2xlYFxuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ2VudW0nOlxuICAgICAgICBndWkgPSBuZXcgX0VudW1HdWkoJGNvbnRhaW5lciwgcGFyYW0sIGNvbmZpZyk7IC8vIGBTZWxlY3RMaXN0YCBvciBgU2VsZWN0QnV0dG9uc2BcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICBndWkgPSBuZXcgX051bWJlckd1aSgkY29udGFpbmVyLCBwYXJhbSwgY29uZmlnKTsgLy8gYE51bWJlckJveGAgb3IgYFNsaWRlcmBcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICd0ZXh0JzpcbiAgICAgICAgZ3VpID0gbmV3IF9UZXh0R3VpKCRjb250YWluZXIsIHBhcmFtLCBjb25maWcpOyAvLyBgVGV4dGBcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICd0cmlnZ2VyJzpcbiAgICAgICAgZ3VpID0gbmV3IF9UcmlnZ2VyR3VpKCRjb250YWluZXIsIHBhcmFtLCBjb25maWcpO1xuICAgICAgICBicmVhaztcbiAgICB9XG5cbiAgICByZXR1cm4gZ3VpO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IENvbnRyb2xsZXJTY2VuZTtcbiJdfQ==